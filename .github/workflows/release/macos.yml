name: Release for macOS

on:
   workflow_call:
      inputs:
         tag:
            description: Tag
            required: true
            type: string
      secrets:
         GITHUB_TOKEN:
            description: GitHub token
            required: true

jobs:
   release-macos:
      runs-on: macos-latest
      steps:
         -  name: Checkout
            uses: actions/checkout@v4

         -  name: Setup Go
            uses: actions/setup-go@v5
            with:
               go-version-file: "go.mod"

         -  shell: bash
            run: brew install create-dmg

         -  name: Build
            shell: bash
            run: |
               set -e
               mkdir dist
               cd build/macos
               chmod +x build.sh
               ./build.sh ${{ inputs.tag }}
               mv spicetify.dmg ../../dist/spicetify-${{ inputs.tag }}.dmg

         -  name: Release
            uses: softprops/action-gh-release@v2
            with:
               files: "dist/*"
            env:
               GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
